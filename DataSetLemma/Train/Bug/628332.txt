Double-free when compartment allocation fails.
Created attachment 506464
Remove first call to FinishJIT

If |js_new<JaegerCompartment>| fails, JSCompartment::init() call FinishJIT, and then fails. Once it fails, it parent NewCompartment call |js_delete(compartment)|, which call FinishJIT again. Solution: don't call FinishJIT the first time.


Here's the log, which is fixed by the patch.

An allocation failure at allocation 72/260 in ../jit-test/tests/arguments/args-createontrace.js cause problem (detected using bug 624094)

Command (from obj directory, using patch from bug 624094):
shell/js -A 72 -m -j -p -e "const platform='darwin'; const libdir='../jit-test/lib/';" -f ../jit-test/lib/prolog.js -f ../jit-test/tests/arguments/args-createontrace.js

stdout, stderr, exitcode:
('', 'js(91218,0x7fff70672ca0) malloc: *** error for object 0x10180fc00: pointer being freed wa not allocated\n*** set a breakpoint in malloc_error_break to debug\n', -6)

Diagnosis:
- Double-free

Stack trace (from valgrind):


The site of the failed allocation is:
at: VALGRIND_PRINTF_BACKTRACE (valgrind.h:4477)
by: js_malloc (jsutil.h:232)
by: js::mjit::JaegerCompartment* js_new<js::mjit::JaegerCompartment>() (jsutil.h:277)
by: JSCompartment::init() (jscompartment.cpp:122)
by: js::gc::NewCompartment(JSContext*, JSPrincipals*) (jsgc.cpp:2862)
by: JS_NewCompartmentAndGlobalObject (jsapi.cpp:2959)
by: NewGlobalObject(JSContext*) (js.cpp:5341)
by: Shell(JSContext*, int, char**, char**) (js.cpp:5389)
by: main (js.cpp:5563)
Invalid read of size x
at: js::detail::HashTable<js::HashMap<unsigned char*, unsigned long, js::DefaultHasher<unsigned char*>, js::SystemAllocPolicy>::Entry, js::HashMap<unsigned char*, unsigned long, js::DefaultHasher<unsigned char*>, js::SystemAllocPolicy>::MapHashPolicy, js::SystemAllocPolicy>::~HashTable() (jshashtable.h:367)
by: js::HashMap<unsigned char*, unsigned long, js::DefaultHasher<unsigned char*>, js::SystemAllocPolicy>::~HashMap() (jshashtable.h:767)
by: void js_delete<js::HashMap<unsigned char*, unsigned long, js::DefaultHasher<unsigned char*>, js::SystemAllocPolicy> >(js::HashMap<unsigned char*, unsigned long, js::DefaultHasher<unsigned char*>, js::SystemAllocPolicy>*) (jsutil.h:307)
by: js::FinishJIT(js::TraceMonitor*) (jstracer.cpp:7821)
by: JSCompartment::~JSCompartment() (jscompartment.cpp:81)
by: void js_delete<JSCompartment>(JSCompartment*) (jsutil.h:307)
by: js::gc::NewCompartment(JSContext*, JSPrincipals*) (jsgc.cpp:2863)
by: JS_NewCompartmentAndGlobalObject (jsapi.cpp:2959)
by: NewGlobalObject(JSContext*) (js.cpp:5341)
by: Shell(JSContext*, int, char**, char**) (js.cpp:5389)
by: main (js.cpp:5563)
Address 0x is byte inside a block of size free'd
at: free (vg_replace_malloc.c:366)
by: js_free (jsutil.h:247)
by: void js_delete<js::HashMap<unsigned char*, unsigned long, js::DefaultHasher<unsigned char*>, js::SystemAllocPolicy> >(js::HashMap<unsigned char*, unsigned long, js::DefaultHasher<unsigned char*>, js::SystemAllocPolicy>*) (jsutil.h:308)
by: js::FinishJIT(js::TraceMonitor*) (jstracer.cpp:7821)
by: JSCompartment::init() (jscompartment.cpp:124)
by: js::gc::NewCompartment(JSContext*, JSPrincipals*) (jsgc.cpp:2862)
by: JS_NewCompartmentAndGlobalObject (jsapi.cpp:2959)
by: NewGlobalObject(JSContext*) (js.cpp:5341)
by: Shell(JSContext*, int, char**, char**) (js.cpp:5389)
by: main (js.cpp:5563)

Invalid read of size x
at: js::detail::HashTable<js::HashMap<unsigned char*, unsigned long, js::DefaultHasher<unsigned char*>, js::SystemAllocPolicy>::Entry, js::HashMap<unsigned char*, unsigned long, js::DefaultHasher<unsigned char*>, js::SystemAllocPolicy>::MapHashPolicy, js::SystemAllocPolicy>::~HashTable() (jshashtable.h:368)
by: js::HashMap<unsigned char*, unsigned long, js::DefaultHasher<unsigned char*>, js::SystemAllocPolicy>::~HashMap() (jshashtable.h:767)
by: void js_delete<js::HashMap<unsigned char*, unsigned long, js::DefaultHasher<unsigned char*>, js::SystemAllocPolicy> >(js::HashMap<unsigned char*, unsigned long, js::DefaultHasher<unsigned char*>, js::SystemAllocPolicy>*) (jsutil.h:307)
by: js::FinishJIT(js::TraceMonitor*) (jstracer.cpp:7821)
by: JSCompartment::~JSCompartment() (jscompartment.cpp:81)
by: void js_delete<JSCompartment>(JSCompartment*) (jsutil.h:307)
by: js::gc::NewCompartment(JSContext*, JSPrincipals*) (jsgc.cpp:2863)
by: JS_NewCompartmentAndGlobalObject (jsapi.cpp:2959)
by: NewGlobalObject(JSContext*) (js.cpp:5341)
by: Shell(JSContext*, int, char**, char**) (js.cpp:5389)
by: main (js.cpp:5563)
Address 0x is byte inside a block of size free'd
at: free (vg_replace_malloc.c:366)
by: js_free (jsutil.h:247)
by: void js_delete<js::HashMap<unsigned char*, unsigned long, js::DefaultHasher<unsigned char*>, js::SystemAllocPolicy> >(js::HashMap<unsigned char*, unsigned long, js::DefaultHasher<unsigned char*>, js::SystemAllocPolicy>*) (jsutil.h:308)
by: js::FinishJIT(js::TraceMonitor*) (jstracer.cpp:7821)
by: JSCompartment::init() (jscompartment.cpp:124)
by: js::gc::NewCompartment(JSContext*, JSPrincipals*) (jsgc.cpp:2862)
by: JS_NewCompartmentAndGlobalObject (jsapi.cpp:2959)
by: NewGlobalObject(JSContext*) (js.cpp:5341)
by: Shell(JSContext*, int, char**, char**) (js.cpp:5389)
by: main (js.cpp:5563)

Invalid read of size x
at: js::detail::HashTable<js::HashMap<unsigned char*, unsigned long, js::DefaultHasher<unsigned char*>, js::SystemAllocPolicy>::Entry, js::HashMap<unsigned char*, unsigned long, js::DefaultHasher<unsigned char*>, js::SystemAllocPolicy>::MapHashPolicy, js::SystemAllocPolicy>::~HashTable() (jshashtable.h:368)
by: js::HashMap<unsigned char*, unsigned long, js::DefaultHasher<unsigned char*>, js::SystemAllocPolicy>::~HashMap() (jshashtable.h:767)
by: void js_delete<js::HashMap<unsigned char*, unsigned long, js::DefaultHasher<unsigned char*>, js::SystemAllocPolicy> >(js::HashMap<unsigned char*, unsigned long, js::DefaultHasher<unsigned char*>, js::SystemAllocPolicy>*) (jsutil.h:307)
by: js::FinishJIT(js::TraceMonitor*) (jstracer.cpp:7821)
by: JSCompartment::~JSCompartment() (jscompartment.cpp:81)
by: void js_delete<JSCompartment>(JSCompartment*) (jsutil.h:307)
by: js::gc::NewCompartment(JSContext*, JSPrincipals*) (jsgc.cpp:2863)
by: JS_NewCompartmentAndGlobalObject (jsapi.cpp:2959)
by: NewGlobalObject(JSContext*) (js.cpp:5341)
by: Shell(JSContext*, int, char**, char**) (js.cpp:5389)
by: main (js.cpp:5563)
Address 0x is byte inside a block of size free'd
at: free (vg_replace_malloc.c:366)
by: js_free (jsutil.h:247)
by: void js_delete<js::HashMap<unsigned char*, unsigned long, js::DefaultHasher<unsigned char*>, js::SystemAllocPolicy> >(js::HashMap<unsigned char*, unsigned long, js::DefaultHasher<unsigned char*>, js::SystemAllocPolicy>*) (jsutil.h:308)
by: js::FinishJIT(js::TraceMonitor*) (jstracer.cpp:7821)
by: JSCompartment::init() (jscompartment.cpp:124)
by: js::gc::NewCompartment(JSContext*, JSPrincipals*) (jsgc.cpp:2862)
by: JS_NewCompartmentAndGlobalObject (jsapi.cpp:2959)
by: NewGlobalObject(JSContext*) (js.cpp:5341)
by: Shell(JSContext*, int, char**, char**) (js.cpp:5389)
by: main (js.cpp:5563)

Invalid free() / delete / delete[]
at: free (vg_replace_malloc.c:366)
by: js_free (jsutil.h:247)
by: js::SystemAllocPolicy::free(void*) (jstl.h:257)
by: js::detail::HashTable<js::HashMap<unsigned char*, unsigned long, js::DefaultHasher<unsigned char*>, js::SystemAllocPolicy>::Entry, js::HashMap<unsigned char*, unsigned long, js::DefaultHasher<unsigned char*>, js::SystemAllocPolicy>::MapHashPolicy, js::SystemAllocPolicy>::destroyTable(js::SystemAllocPolicy&, js::detail::HashTable<js::HashMap<unsigned char*, unsigned long, js::DefaultHasher<unsigned char*>, js::SystemAllocPolicy>::Entry, js::HashMap<unsigned char*, unsigned long, js::DefaultHasher<unsigned char*>, js::SystemAllocPolicy>::MapHashPolicy, js::SystemAllocPolicy>::Entry*, unsigned int) (jshashtable.h:307)
by: js::detail::HashTable<js::HashMap<unsigned char*, unsigned long, js::DefaultHasher<unsigned char*>, js::SystemAllocPolicy>::Entry, js::HashMap<unsigned char*, unsigned long, js::DefaultHasher<unsigned char*>, js::SystemAllocPolicy>::MapHashPolicy, js::SystemAllocPolicy>::~HashTable() (jshashtable.h:368)
by: js::HashMap<unsigned char*, unsigned long, js::DefaultHasher<unsigned char*>, js::SystemAllocPolicy>::~HashMap() (jshashtable.h:767)
by: void js_delete<js::HashMap<unsigned char*, unsigned long, js::DefaultHasher<unsigned char*>, js::SystemAllocPolicy> >(js::HashMap<unsigned char*, unsigned long, js::DefaultHasher<unsigned char*>, js::SystemAllocPolicy>*) (jsutil.h:307)
by: js::FinishJIT(js::TraceMonitor*) (jstracer.cpp:7821)
by: JSCompartment::~JSCompartment() (jscompartment.cpp:81)
by: void js_delete<JSCompartment>(JSCompartment*) (jsutil.h:307)
by: js::gc::NewCompartment(JSContext*, JSPrincipals*) (jsgc.cpp:2863)
by: JS_NewCompartmentAndGlobalObject (jsapi.cpp:2959)
Address 0x is byte inside a block of size free'd
at: free (vg_replace_malloc.c:366)
by: js_free (jsutil.h:247)
by: js::SystemAllocPolicy::free(void*) (jstl.h:257)
by: js::detail::HashTable<js::HashMap<unsigned char*, unsigned long, js::DefaultHasher<unsigned char*>, js::SystemAllocPolicy>::Entry, js::HashMap<unsigned char*, unsigned long, js::DefaultHasher<unsigned char*>, js::SystemAllocPolicy>::MapHashPolicy, js::SystemAllocPolicy>::destroyTable(js::SystemAllocPolicy&, js::detail::HashTable<js::HashMap<unsigned char*, unsigned long, js::DefaultHasher<unsigned char*>, js::SystemAllocPolicy>::Entry, js::HashMap<unsigned char*, unsigned long, js::DefaultHasher<unsigned char*>, js::SystemAllocPolicy>::MapHashPolicy, js::SystemAllocPolicy>::Entry*, unsigned int) (jshashtable.h:307)
by: js::detail::HashTable<js::HashMap<unsigned char*, unsigned long, js::DefaultHasher<unsigned char*>, js::SystemAllocPolicy>::Entry, js::HashMap<unsigned char*, unsigned long, js::DefaultHasher<unsigned char*>, js::SystemAllocPolicy>::MapHashPolicy, js::SystemAllocPolicy>::~HashTable() (jshashtable.h:368)
by: js::HashMap<unsigned char*, unsigned long, js::DefaultHasher<unsigned char*>, js::SystemAllocPolicy>::~HashMap() (jshashtable.h:767)
by: void js_delete<js::HashMap<unsigned char*, unsigned long, js::DefaultHasher<unsigned char*>, js::SystemAllocPolicy> >(js::HashMap<unsigned char*, unsigned long, js::DefaultHasher<unsigned char*>, js::SystemAllocPolicy>*) (jsutil.h:307)
by: js::FinishJIT(js::TraceMonitor*) (jstracer.cpp:7821)
by: JSCompartment::init() (jscompartment.cpp:124)
by: js::gc::NewCompartment(JSContext*, JSPrincipals*) (jsgc.cpp:2862)
by: JS_NewCompartmentAndGlobalObject (jsapi.cpp:2959)
by: NewGlobalObject(JSContext*) (js.cpp:5341)

Invalid free() / delete / delete[]
at: free (vg_replace_malloc.c:366)
by: js_free (jsutil.h:247)
by: void js_delete<js::HashMap<unsigned char*, unsigned long, js::DefaultHasher<unsigned char*>, js::SystemAllocPolicy> >(js::HashMap<unsigned char*, unsigned long, js::DefaultHasher<unsigned char*>, js::SystemAllocPolicy>*) (jsutil.h:308)
by: js::FinishJIT(js::TraceMonitor*) (jstracer.cpp:7821)
by: JSCompartment::~JSCompartment() (jscompartment.cpp:81)
by: void js_delete<JSCompartment>(JSCompartment*) (jsutil.h:307)
by: js::gc::NewCompartment(JSContext*, JSPrincipals*) (jsgc.cpp:2863)
by: JS_NewCompartmentAndGlobalObject (jsapi.cpp:2959)
by: NewGlobalObject(JSContext*) (js.cpp:5341)
by: Shell(JSContext*, int, char**, char**) (js.cpp:5389)
by: main (js.cpp:5563)
Address 0x is byte inside a block of size free'd
at: free (vg_replace_malloc.c:366)
by: js_free (jsutil.h:247)
by: void js_delete<js::HashMap<unsigned char*, unsigned long, js::DefaultHasher<unsigned char*>, js::SystemAllocPolicy> >(js::HashMap<unsigned char*, unsigned long, js::DefaultHasher<unsigned char*>, js::SystemAllocPolicy>*) (jsutil.h:308)
by: js::FinishJIT(js::TraceMonitor*) (jstracer.cpp:7821)
by: JSCompartment::init() (jscompartment.cpp:124)
by: js::gc::NewCompartment(JSContext*, JSPrincipals*) (jsgc.cpp:2862)
by: JS_NewCompartmentAndGlobalObject (jsapi.cpp:2959)
by: NewGlobalObject(JSContext*) (js.cpp:5341)
by: Shell(JSContext*, int, char**, char**) (js.cpp:5389)
by: main (js.cpp:5563)

Invalid read of size x
at: js::detail::HashTable<js::HashMap<unsigned char*, js::LoopProfile*, js::DefaultHasher<unsigned char*>, js::SystemAllocPolicy>::Entry, js::HashMap<unsigned char*, js::LoopProfile*, js::DefaultHasher<unsigned char*>, js::SystemAllocPolicy>::MapHashPolicy, js::SystemAllocPolicy>::~HashTable() (jshashtable.h:367)
by: js::HashMap<unsigned char*, js::LoopProfile*, js::DefaultHasher<unsigned char*>, js::SystemAllocPolicy>::~HashMap() (jshashtable.h:767)
by: void js_delete<js::HashMap<unsigned char*, js::LoopProfile*, js::DefaultHasher<unsigned char*>, js::SystemAllocPolicy> >(js::HashMap<unsigned char*, js::LoopProfile*, js::DefaultHasher<unsigned char*>, js::SystemAllocPolicy>*) (jsutil.h:307)
by: js::FinishJIT(js::TraceMonitor*) (jstracer.cpp:7822)
by: JSCompartment::~JSCompartment() (jscompartment.cpp:81)
by: void js_delete<JSCompartment>(JSCompartment*) (jsutil.h:307)
by: js::gc::NewCompartment(JSContext*, JSPrincipals*) (jsgc.cpp:2863)
by: JS_NewCompartmentAndGlobalObject (jsapi.cpp:2959)
by: NewGlobalObject(JSContext*) (js.cpp:5341)
by: Shell(JSContext*, int, char**, char**) (js.cpp:5389)
by: main (js.cpp:5563)
Address 0x is byte inside a block of size free'd
at: free (vg_replace_malloc.c:366)
by: js_free (jsutil.h:247)
by: void js_delete<js::HashMap<unsigned char*, js::LoopProfile*, js::DefaultHasher<unsigned char*>, js::SystemAllocPolicy> >(js::HashMap<unsigned char*, js::LoopProfile*, js::DefaultHasher<unsigned char*>, js::SystemAllocPolicy>*) (jsutil.h:308)
by: js::FinishJIT(js::TraceMonitor*) (jstracer.cpp:7822)
by: JSCompartment::init() (jscompartment.cpp:124)
by: js::gc::NewCompartment(JSContext*, JSPrincipals*) (jsgc.cpp:2862)
by: JS_NewCompartmentAndGlobalObject (jsapi.cpp:2959)
by: NewGlobalObject(JSContext*) (js.cpp:5341)
by: Shell(JSContext*, int, char**, char**) (js.cpp:5389)
by: main (js.cpp:5563)

Invalid read of size x
at: js::detail::HashTable<js::HashMap<unsigned char*, js::LoopProfile*, js::DefaultHasher<unsigned char*>, js::SystemAllocPolicy>::Entry, js::HashMap<unsigned char*, js::LoopProfile*, js::DefaultHasher<unsigned char*>, js::SystemAllocPolicy>::MapHashPolicy, js::SystemAllocPolicy>::~HashTable() (jshashtable.h:368)
by: js::HashMap<unsigned char*, js::LoopProfile*, js::DefaultHasher<unsigned char*>, js::SystemAllocPolicy>::~HashMap() (jshashtable.h:767)
by: void js_delete<js::HashMap<unsigned char*, js::LoopProfile*, js::DefaultHasher<unsigned char*>, js::SystemAllocPolicy> >(js::HashMap<unsigned char*, js::LoopProfile*, js::DefaultHasher<unsigned char*>, js::SystemAllocPolicy>*) (jsutil.h:307)
by: js::FinishJIT(js::TraceMonitor*) (jstracer.cpp:7822)
by: JSCompartment::~JSCompartment() (jscompartment.cpp:81)
by: void js_delete<JSCompartment>(JSCompartment*) (jsutil.h:307)
by: js::gc::NewCompartment(JSContext*, JSPrincipals*) (jsgc.cpp:2863)
by: JS_NewCompartmentAndGlobalObject (jsapi.cpp:2959)
by: NewGlobalObject(JSContext*) (js.cpp:5341)
by: Shell(JSContext*, int, char**, char**) (js.cpp:5389)
by: main (js.cpp:5563)
Address 0x is byte inside a block of size free'd
at: free (vg_replace_malloc.c:366)
by: js_free (jsutil.h:247)
by: void js_delete<js::HashMap<unsigned char*, js::LoopProfile*, js::DefaultHasher<unsigned char*>, js::SystemAllocPolicy> >(js::HashMap<unsigned char*, js::LoopProfile*, js::DefaultHasher<unsigned char*>, js::SystemAllocPolicy>*) (jsutil.h:308)
by: js::FinishJIT(js::TraceMonitor*) (jstracer.cpp:7822)
by: JSCompartment::init() (jscompartment.cpp:124)
by: js::gc::NewCompartment(JSContext*, JSPrincipals*) (jsgc.cpp:2862)
by: JS_NewCompartmentAndGlobalObject (jsapi.cpp:2959)
by: NewGlobalObject(JSContext*) (js.cpp:5341)
by: Shell(JSContext*, int, char**, char**) (js.cpp:5389)
by: main (js.cpp:5563)

Invalid read of size x
at: js::detail::HashTable<js::HashMap<unsigned char*, js::LoopProfile*, js::DefaultHasher<unsigned char*>, js::SystemAllocPolicy>::Entry, js::HashMap<unsigned char*, js::LoopProfile*, js::DefaultHasher<unsigned char*>, js::SystemAllocPolicy>::MapHashPolicy, js::SystemAllocPolicy>::~HashTable() (jshashtable.h:368)
by: js::HashMap<unsigned char*, js::LoopProfile*, js::DefaultHasher<unsigned char*>, js::SystemAllocPolicy>::~HashMap() (jshashtable.h:767)
by: void js_delete<js::HashMap<unsigned char*, js::LoopProfile*, js::DefaultHasher<unsigned char*>, js::SystemAllocPolicy> >(js::HashMap<unsigned char*, js::LoopProfile*, js::DefaultHasher<unsigned char*>, js::SystemAllocPolicy>*) (jsutil.h:307)
by: js::FinishJIT(js::TraceMonitor*) (jstracer.cpp:7822)
by: JSCompartment::~JSCompartment() (jscompartment.cpp:81)
by: void js_delete<JSCompartment>(JSCompartment*) (jsutil.h:307)
by: js::gc::NewCompartment(JSContext*, JSPrincipals*) (jsgc.cpp:2863)
by: JS_NewCompartmentAndGlobalObject (jsapi.cpp:2959)
by: NewGlobalObject(JSContext*) (js.cpp:5341)
by: Shell(JSContext*, int, char**, char**) (js.cpp:5389)
by: main (js.cpp:5563)
Address 0x is byte inside a block of size free'd
at: free (vg_replace_malloc.c:366)
by: js_free (jsutil.h:247)
by: void js_delete<js::HashMap<unsigned char*, js::LoopProfile*, js::DefaultHasher<unsigned char*>, js::SystemAllocPolicy> >(js::HashMap<unsigned char*, js::LoopProfile*, js::DefaultHasher<unsigned char*>, js::SystemAllocPolicy>*) (jsutil.h:308)
by: js::FinishJIT(js::TraceMonitor*) (jstracer.cpp:7822)
by: JSCompartment::init() (jscompartment.cpp:124)
by: js::gc::NewCompartment(JSContext*, JSPrincipals*) (jsgc.cpp:2862)
by: JS_NewCompartmentAndGlobalObject (jsapi.cpp:2959)
by: NewGlobalObject(JSContext*) (js.cpp:5341)
by: Shell(JSContext*, int, char**, char**) (js.cpp:5389)
by: main (js.cpp:5563)

Invalid free() / delete / delete[]
at: free (vg_replace_malloc.c:366)
by: js_free (jsutil.h:247)
by: js::SystemAllocPolicy::free(void*) (jstl.h:257)
by: js::detail::HashTable<js::HashMap<unsigned char*, js::LoopProfile*, js::DefaultHasher<unsigned char*>, js::SystemAllocPolicy>::Entry, js::HashMap<unsigned char*, js::LoopProfile*, js::DefaultHasher<unsigned char*>, js::SystemAllocPolicy>::MapHashPolicy, js::SystemAllocPolicy>::destroyTable(js::SystemAllocPolicy&, js::detail::HashTable<js::HashMap<unsigned char*, js::LoopProfile*, js::DefaultHasher<unsigned char*>, js::SystemAllocPolicy>::Entry, js::HashMap<unsigned char*, js::LoopProfile*, js::DefaultHasher<unsigned char*>, js::SystemAllocPolicy>::MapHashPolicy, js::SystemAllocPolicy>::Entry*, unsigned int) (jshashtable.h:307)
by: js::detail::HashTable<js::HashMap<unsigned char*, js::LoopProfile*, js::DefaultHasher<unsigned char*>, js::SystemAllocPolicy>::Entry, js::HashMap<unsigned char*, js::LoopProfile*, js::DefaultHasher<unsigned char*>, js::SystemAllocPolicy>::MapHashPolicy, js::SystemAllocPolicy>::~HashTable() (jshashtable.h:368)
by: js::HashMap<unsigned char*, js::LoopProfile*, js::DefaultHasher<unsigned char*>, js::SystemAllocPolicy>::~HashMap() (jshashtable.h:767)
by: void js_delete<js::HashMap<unsigned char*, js::LoopProfile*, js::DefaultHasher<unsigned char*>, js::SystemAllocPolicy> >(js::HashMap<unsigned char*, js::LoopProfile*, js::DefaultHasher<unsigned char*>, js::SystemAllocPolicy>*) (jsutil.h:307)
by: js::FinishJIT(js::TraceMonitor*) (jstracer.cpp:7822)
by: JSCompartment::~JSCompartment() (jscompartment.cpp:81)
by: void js_delete<JSCompartment>(JSCompartment*) (jsutil.h:307)
by: js::gc::NewCompartment(JSContext*, JSPrincipals*) (jsgc.cpp:2863)
by: JS_NewCompartmentAndGlobalObject (jsapi.cpp:2959)
Address 0x is byte inside a block of size free'd
at: free (vg_replace_malloc.c:366)
by: js_free (jsutil.h:247)
by: js::SystemAllocPolicy::free(void*) (jstl.h:257)
by: js::detail::HashTable<js::HashMap<unsigned char*, js::LoopProfile*, js::DefaultHasher<unsigned char*>, js::SystemAllocPolicy>::Entry, js::HashMap<unsigned char*, js::LoopProfile*, js::DefaultHasher<unsigned char*>, js::SystemAllocPolicy>::MapHashPolicy, js::SystemAllocPolicy>::destroyTable(js::SystemAllocPolicy&, js::detail::HashTable<js::HashMap<unsigned char*, js::LoopProfile*, js::DefaultHasher<unsigned char*>, js::SystemAllocPolicy>::Entry, js::HashMap<unsigned char*, js::LoopProfile*, js::DefaultHasher<unsigned char*>, js::SystemAllocPolicy>::MapHashPolicy, js::SystemAllocPolicy>::Entry*, unsigned int) (jshashtable.h:307)
by: js::detail::HashTable<js::HashMap<unsigned char*, js::LoopProfile*, js::DefaultHasher<unsigned char*>, js::SystemAllocPolicy>::Entry, js::HashMap<unsigned char*, js::LoopProfile*, js::DefaultHasher<unsigned char*>, js::SystemAllocPolicy>::MapHashPolicy, js::SystemAllocPolicy>::~HashTable() (jshashtable.h:368)
by: js::HashMap<unsigned char*, js::LoopProfile*, js::DefaultHasher<unsigned char*>, js::SystemAllocPolicy>::~HashMap() (jshashtable.h:767)
by: void js_delete<js::HashMap<unsigned char*, js::LoopProfile*, js::DefaultHasher<unsigned char*>, js::SystemAllocPolicy> >(js::HashMap<unsigned char*, js::LoopProfile*, js::DefaultHasher<unsigned char*>, js::SystemAllocPolicy>*) (jsutil.h:307)
by: js::FinishJIT(js::TraceMonitor*) (jstracer.cpp:7822)
by: JSCompartment::init() (jscompartment.cpp:124)
by: js::gc::NewCompartment(JSContext*, JSPrincipals*) (jsgc.cpp:2862)
by: JS_NewCompartmentAndGlobalObject (jsapi.cpp:2959)
by: NewGlobalObject(JSContext*) (js.cpp:5341)

Invalid free() / delete / delete[]
at: free (vg_replace_malloc.c:366)
by: js_free (jsutil.h:247)
by: void js_delete<js::HashMap<unsigned char*, js::LoopProfile*, js::DefaultHasher<unsigned char*>, js::SystemAllocPolicy> >(js::HashMap<unsigned char*, js::LoopProfile*, js::DefaultHasher<unsigned char*>, js::SystemAllocPolicy>*) (jsutil.h:308)
by: js::FinishJIT(js::TraceMonitor*) (jstracer.cpp:7822)
by: JSCompartment::~JSCompartment() (jscompartment.cpp:81)
by: void js_delete<JSCompartment>(JSCompartment*) (jsutil.h:307)
by: js::gc::NewCompartment(JSContext*, JSPrincipals*) (jsgc.cpp:2863)
by: JS_NewCompartmentAndGlobalObject (jsapi.cpp:2959)
by: NewGlobalObject(JSContext*) (js.cpp:5341)
by: Shell(JSContext*, int, char**, char**) (js.cpp:5389)
by: main (js.cpp:5563)
Address 0x is byte inside a block of size free'd
at: free (vg_replace_malloc.c:366)
by: js_free (jsutil.h:247)
by: void js_delete<js::HashMap<unsigned char*, js::LoopProfile*, js::DefaultHasher<unsigned char*>, js::SystemAllocPolicy> >(js::HashMap<unsigned char*, js::LoopProfile*, js::DefaultHasher<unsigned char*>, js::SystemAllocPolicy>*) (jsutil.h:308)
by: js::FinishJIT(js::TraceMonitor*) (jstracer.cpp:7822)
by: JSCompartment::init() (jscompartment.cpp:124)
by: js::gc::NewCompartment(JSContext*, JSPrincipals*) (jsgc.cpp:2862)
by: JS_NewCompartmentAndGlobalObject (jsapi.cpp:2959)
by: NewGlobalObject(JSContext*) (js.cpp:5341)
by: Shell(JSContext*, int, char**, char**) (js.cpp:5389)
by: main (js.cpp:5563)

Invalid read of size x
at: avmplus::BitSet::~BitSet() (avmplus.h:285)
by: js::Oracle::~Oracle() (jstracer.h:282)
by: void js_delete<js::Oracle>(js::Oracle*) (jsutil.h:307)
by: js::FinishJIT(js::TraceMonitor*) (jstracer.cpp:7823)
by: JSCompartment::~JSCompartment() (jscompartment.cpp:81)
by: void js_delete<JSCompartment>(JSCompartment*) (jsutil.h:307)
by: js::gc::NewCompartment(JSContext*, JSPrincipals*) (jsgc.cpp:2863)
by: JS_NewCompartmentAndGlobalObject (jsapi.cpp:2959)
by: NewGlobalObject(JSContext*) (js.cpp:5341)
by: Shell(JSContext*, int, char**, char**) (js.cpp:5389)
by: main (js.cpp:5563)
Address 0x is byte inside a block of size free'd
at: free (vg_replace_malloc.c:366)
by: js_free (jsutil.h:247)
by: void js_delete<js::Oracle>(js::Oracle*) (jsutil.h:308)
by: js::FinishJIT(js::TraceMonitor*) (jstracer.cpp:7823)
by: JSCompartment::init() (jscompartment.cpp:124)
by: js::gc::NewCompartment(JSContext*, JSPrincipals*) (jsgc.cpp:2862)
by: JS_NewCompartmentAndGlobalObject (jsapi.cpp:2959)
by: NewGlobalObject(JSContext*) (js.cpp:5341)
by: Shell(JSContext*, int, char**, char**) (js.cpp:5389)
by: main (js.cpp:5563)

Invalid free() / delete / delete[]
at: free (vg_replace_malloc.c:366)
by: avmplus::BitSet::~BitSet() (avmplus.h:285)
by: js::Oracle::~Oracle() (jstracer.h:282)
by: void js_delete<js::Oracle>(js::Oracle*) (jsutil.h:307)
by: js::FinishJIT(js::TraceMonitor*) (jstracer.cpp:7823)
by: JSCompartment::~JSCompartment() (jscompartment.cpp:81)
by: void js_delete<JSCompartment>(JSCompartment*) (jsutil.h:307)
by: js::gc::NewCompartment(JSContext*, JSPrincipals*) (jsgc.cpp:2863)
by: JS_NewCompartmentAndGlobalObject (jsapi.cpp:2959)
by: NewGlobalObject(JSContext*) (js.cpp:5341)
by: Shell(JSContext*, int, char**, char**) (js.cpp:5389)
by: main (js.cpp:5563)
Address 0x is byte inside a block of size free'd
at: free (vg_replace_malloc.c:366)
by: avmplus::BitSet::~BitSet() (avmplus.h:285)
by: js::Oracle::~Oracle() (jstracer.h:282)
by: void js_delete<js::Oracle>(js::Oracle*) (jsutil.h:307)
by: js::FinishJIT(js::TraceMonitor*) (jstracer.cpp:7823)
by: JSCompartment::init() (jscompartment.cpp:124)
by: js::gc::NewCompartment(JSContext*, JSPrincipals*) (jsgc.cpp:2862)
by: JS_NewCompartmentAndGlobalObject (jsapi.cpp:2959)
by: NewGlobalObject(JSContext*) (js.cpp:5341)
by: Shell(JSContext*, int, char**, char**) (js.cpp:5389)
by: main (js.cpp:5563)

Invalid read of size x
at: avmplus::BitSet::~BitSet() (avmplus.h:285)
by: js::Oracle::~Oracle() (jstracer.h:282)
by: void js_delete<js::Oracle>(js::Oracle*) (jsutil.h:307)
by: js::FinishJIT(js::TraceMonitor*) (jstracer.cpp:7823)
by: JSCompartment::~JSCompartment() (jscompartment.cpp:81)
by: void js_delete<JSCompartment>(JSCompartment*) (jsutil.h:307)
by: js::gc::NewCompartment(JSContext*, JSPrincipals*) (jsgc.cpp:2863)
by: JS_NewCompartmentAndGlobalObject (jsapi.cpp:2959)
by: NewGlobalObject(JSContext*) (js.cpp:5341)
by: Shell(JSContext*, int, char**, char**) (js.cpp:5389)
by: main (js.cpp:5563)
Address 0x is byte inside a block of size free'd
at: free (vg_replace_malloc.c:366)
by: js_free (jsutil.h:247)
by: void js_delete<js::Oracle>(js::Oracle*) (jsutil.h:308)
by: js::FinishJIT(js::TraceMonitor*) (jstracer.cpp:7823)
by: JSCompartment::init() (jscompartment.cpp:124)
by: js::gc::NewCompartment(JSContext*, JSPrincipals*) (jsgc.cpp:2862)
by: JS_NewCompartmentAndGlobalObject (jsapi.cpp:2959)
by: NewGlobalObject(JSContext*) (js.cpp:5341)
by: Shell(JSContext*, int, char**, char**) (js.cpp:5389)
by: main (js.cpp:5563)

Invalid free() / delete / delete[]
at: free (vg_replace_malloc.c:366)
by: avmplus::BitSet::~BitSet() (avmplus.h:285)
by: js::Oracle::~Oracle() (jstracer.h:282)
by: void js_delete<js::Oracle>(js::Oracle*) (jsutil.h:307)
by: js::FinishJIT(js::TraceMonitor*) (jstracer.cpp:7823)
by: JSCompartment::~JSCompartment() (jscompartment.cpp:81)
by: void js_delete<JSCompartment>(JSCompartment*) (jsutil.h:307)
by: js::gc::NewCompartment(JSContext*, JSPrincipals*) (jsgc.cpp:2863)
by: JS_NewCompartmentAndGlobalObject (jsapi.cpp:2959)
by: NewGlobalObject(JSContext*) (js.cpp:5341)
by: Shell(JSContext*, int, char**, char**) (js.cpp:5389)
by: main (js.cpp:5563)
Address 0x is byte inside a block of size free'd
at: free (vg_replace_malloc.c:366)
by: avmplus::BitSet::~BitSet() (avmplus.h:285)
by: js::Oracle::~Oracle() (jstracer.h:282)
by: void js_delete<js::Oracle>(js::Oracle*) (jsutil.h:307)
by: js::FinishJIT(js::TraceMonitor*) (jstracer.cpp:7823)
by: JSCompartment::init() (jscompartment.cpp:124)
by: js::gc::NewCompartment(JSContext*, JSPrincipals*) (jsgc.cpp:2862)
by: JS_NewCompartmentAndGlobalObject (jsapi.cpp:2959)
by: NewGlobalObject(JSContext*) (js.cpp:5341)
by: Shell(JSContext*, int, char**, char**) (js.cpp:5389)
by: main (js.cpp:5563)

Invalid read of size x
at: avmplus::BitSet::~BitSet() (avmplus.h:285)
by: js::Oracle::~Oracle() (jstracer.h:282)
by: void js_delete<js::Oracle>(js::Oracle*) (jsutil.h:307)
by: js::FinishJIT(js::TraceMonitor*) (jstracer.cpp:7823)
by: JSCompartment::~JSCompartment() (jscompartment.cpp:81)
by: void js_delete<JSCompartment>(JSCompartment*) (jsutil.h:307)
by: js::gc::NewCompartment(JSContext*, JSPrincipals*) (jsgc.cpp:2863)
by: JS_NewCompartmentAndGlobalObject (jsapi.cpp:2959)
by: NewGlobalObject(JSContext*) (js.cpp:5341)
by: Shell(JSContext*, int, char**, char**) (js.cpp:5389)
by: main (js.cpp:5563)
Address 0x is byte inside a block of size free'd
at: free (vg_replace_malloc.c:366)
by: js_free (jsutil.h:247)
by: void js_delete<js::Oracle>(js::Oracle*) (jsutil.h:308)
by: js::FinishJIT(js::TraceMonitor*) (jstracer.cpp:7823)
by: JSCompartment::init() (jscompartment.cpp:124)
by: js::gc::NewCompartment(JSContext*, JSPrincipals*) (jsgc.cpp:2862)
by: JS_NewCompartmentAndGlobalObject (jsapi.cpp:2959)
by: NewGlobalObject(JSContext*) (js.cpp:5341)
by: Shell(JSContext*, int, char**, char**) (js.cpp:5389)
by: main (js.cpp:5563)

Invalid free() / delete / delete[]
at: free (vg_replace_malloc.c:366)
by: avmplus::BitSet::~BitSet() (avmplus.h:285)
by: js::Oracle::~Oracle() (jstracer.h:282)
by: void js_delete<js::Oracle>(js::Oracle*) (jsutil.h:307)
by: js::FinishJIT(js::TraceMonitor*) (jstracer.cpp:7823)
by: JSCompartment::~JSCompartment() (jscompartment.cpp:81)
by: void js_delete<JSCompartment>(JSCompartment*) (jsutil.h:307)
by: js::gc::NewCompartment(JSContext*, JSPrincipals*) (jsgc.cpp:2863)
by: JS_NewCompartmentAndGlobalObject (jsapi.cpp:2959)
by: NewGlobalObject(JSContext*) (js.cpp:5341)
by: Shell(JSContext*, int, char**, char**) (js.cpp:5389)
by: main (js.cpp:5563)
Address 0x is byte inside a block of size free'd
at: free (vg_replace_malloc.c:366)
by: avmplus::BitSet::~BitSet() (avmplus.h:285)
by: js::Oracle::~Oracle() (jstracer.h:282)
by: void js_delete<js::Oracle>(js::Oracle*) (jsutil.h:307)
by: js::FinishJIT(js::TraceMonitor*) (jstracer.cpp:7823)
by: JSCompartment::init() (jscompartment.cpp:124)
by: js::gc::NewCompartment(JSContext*, JSPrincipals*) (jsgc.cpp:2862)
by: JS_NewCompartmentAndGlobalObject (jsapi.cpp:2959)
by: NewGlobalObject(JSContext*) (js.cpp:5341)
by: Shell(JSContext*, int, char**, char**) (js.cpp:5389)
by: main (js.cpp:5563)

Invalid read of size x
at: avmplus::BitSet::~BitSet() (avmplus.h:285)
by: js::Oracle::~Oracle() (jstracer.h:282)
by: void js_delete<js::Oracle>(js::Oracle*) (jsutil.h:307)
by: js::FinishJIT(js::TraceMonitor*) (jstracer.cpp:7823)
by: JSCompartment::~JSCompartment() (jscompartment.cpp:81)
by: void js_delete<JSCompartment>(JSCompartment*) (jsutil.h:307)
by: js::gc::NewCompartment(JSContext*, JSPrincipals*) (jsgc.cpp:2863)
by: JS_NewCompartmentAndGlobalObject (jsapi.cpp:2959)
by: NewGlobalObject(JSContext*) (js.cpp:5341)
by: Shell(JSContext*, int, char**, char**) (js.cpp:5389)
by: main (js.cpp:5563)
Address 0x is byte inside a block of size free'd
at: free (vg_replace_malloc.c:366)
by: js_free (jsutil.h:247)
by: void js_delete<js::Oracle>(js::Oracle*) (jsutil.h:308)
by: js::FinishJIT(js::TraceMonitor*) (jstracer.cpp:7823)
by: JSCompartment::init() (jscompartment.cpp:124)
by: js::gc::NewCompartment(JSContext*, JSPrincipals*) (jsgc.cpp:2862)
by: JS_NewCompartmentAndGlobalObject (jsapi.cpp:2959)
by: NewGlobalObject(JSContext*) (js.cpp:5341)
by: Shell(JSContext*, int, char**, char**) (js.cpp:5389)
by: main (js.cpp:5563)

Invalid free() / delete / delete[]
at: free (vg_replace_malloc.c:366)
by: avmplus::BitSet::~BitSet() (avmplus.h:285)
by: js::Oracle::~Oracle() (jstracer.h:282)
by: void js_delete<js::Oracle>(js::Oracle*) (jsutil.h:307)
by: js::FinishJIT(js::TraceMonitor*) (jstracer.cpp:7823)
by: JSCompartment::~JSCompartment() (jscompartment.cpp:81)
by: void js_delete<JSCompartment>(JSCompartment*) (jsutil.h:307)
by: js::gc::NewCompartment(JSContext*, JSPrincipals*) (jsgc.cpp:2863)
by: JS_NewCompartmentAndGlobalObject (jsapi.cpp:2959)
by: NewGlobalObject(JSContext*) (js.cpp:5341)
by: Shell(JSContext*, int, char**, char**) (js.cpp:5389)
by: main (js.cpp:5563)
Address 0x is byte inside a block of size free'd
at: free (vg_replace_malloc.c:366)
by: avmplus::BitSet::~BitSet() (avmplus.h:285)
by: js::Oracle::~Oracle() (jstracer.h:282)
by: void js_delete<js::Oracle>(js::Oracle*) (jsutil.h:307)
by: js::FinishJIT(js::TraceMonitor*) (jstracer.cpp:7823)
by: JSCompartment::init() (jscompartment.cpp:124)
by: js::gc::NewCompartment(JSContext*, JSPrincipals*) (jsgc.cpp:2862)
by: JS_NewCompartmentAndGlobalObject (jsapi.cpp:2959)
by: NewGlobalObject(JSContext*) (js.cpp:5341)
by: Shell(JSContext*, int, char**, char**) (js.cpp:5389)
by: main (js.cpp:5563)

Invalid free() / delete / delete[]
at: free (vg_replace_malloc.c:366)
by: js_free (jsutil.h:247)
by: void js_delete<js::Oracle>(js::Oracle*) (jsutil.h:308)
by: js::FinishJIT(js::TraceMonitor*) (jstracer.cpp:7823)
by: JSCompartment::~JSCompartment() (jscompartment.cpp:81)
by: void js_delete<JSCompartment>(JSCompartment*) (jsutil.h:307)
by: js::gc::NewCompartment(JSContext*, JSPrincipals*) (jsgc.cpp:2863)
by: JS_NewCompartmentAndGlobalObject (jsapi.cpp:2959)
by: NewGlobalObject(JSContext*) (js.cpp:5341)
by: Shell(JSContext*, int, char**, char**) (js.cpp:5389)
by: main (js.cpp:5563)
Address 0x is byte inside a block of size free'd
at: free (vg_replace_malloc.c:366)
by: js_free (jsutil.h:247)
by: void js_delete<js::Oracle>(js::Oracle*) (jsutil.h:308)
by: js::FinishJIT(js::TraceMonitor*) (jstracer.cpp:7823)
by: JSCompartment::init() (jscompartment.cpp:124)
by: js::gc::NewCompartment(JSContext*, JSPrincipals*) (jsgc.cpp:2862)
by: JS_NewCompartmentAndGlobalObject (jsapi.cpp:2959)
by: NewGlobalObject(JSContext*) (js.cpp:5341)
by: Shell(JSContext*, int, char**, char**) (js.cpp:5389)
by: main (js.cpp:5563)



The site of the failed allocation is:
at: VALGRIND_PRINTF_BACKTRACE (valgrind.h:4477)
by: js_malloc (jsutil.h:232)
by: js::SystemAllocPolicy::malloc(unsigned long) (jstl.h:255)
by: js::detail::HashTable<unsigned long const, js::HashSet<unsigned long, js::AtomHasher, js::SystemAllocPolicy>::SetOps, js::SystemAllocPolicy>::createTable(js::SystemAllocPolicy&, unsigned int) (jshashtable.h:295)
by: js::detail::HashTable<unsigned long const, js::HashSet<unsigned long, js::AtomHasher, js::SystemAllocPolicy>::SetOps, js::SystemAllocPolicy>::changeTableSize(int) (jshashtable.h:508)
by: js::detail::HashTable<unsigned long const, js::HashSet<unsigned long, js::AtomHasher, js::SystemAllocPolicy>::SetOps, js::SystemAllocPolicy>::checkUnderloaded() (jshashtable.h:550)
by: js::detail::HashTable<unsigned long const, js::HashSet<unsigned long, js::AtomHasher, js::SystemAllocPolicy>::SetOps, js::SystemAllocPolicy>::Enum::~Enum() (jshashtable.h:214)
by: js_SweepAtomState(JSContext*) (jsatom.cpp:457)
by: MarkAndSweep(JSContext*, JSGCInvocationKind) (jsgc.cpp:2444)
by: GCUntilDone(JSContext*, JSCompartment*, JSGCInvocationKind) (jsgc.cpp:2728)
by: js_GC(JSContext*, JSCompartment*, JSGCInvocationKind) (jsgc.cpp:2799)
by: js_DestroyContext(JSContext*, JSDestroyContextMode) (jscntxt.cpp:1075)


The site of the failed allocation is:
at: VALGRIND_PRINTF_BACKTRACE (valgrind.h:4477)
by: js_malloc (jsutil.h:232)
by: js::GCHelperThread::replenishAndFreeLater(void*) (jsgc.cpp:2126)
by: js::GCHelperThread::freeLater(void*) (jsgc.h:928)
by: JSContext::free(void*) (jscntxt.h:2052)
by: JSString::finalize(JSContext*) (jsstrinlines.h:309)
by: void FinalizeArenaList<JSString>(JSCompartment*, JSContext*, unsigned int) (jsgc.cpp:1952)
by: JSCompartment::finalizeStringArenaLists(JSContext*) (jsgc.cpp:2029)
by: MarkAndSweep(JSContext*, JSGCInvocationKind) (jsgc.cpp:2468)
by: GCUntilDone(JSContext*, JSCompartment*, JSGCInvocationKind) (jsgc.cpp:2728)
by: js_GC(JSContext*, JSCompartment*, JSGCInvocationKind) (jsgc.cpp:2799)
by: js_DestroyContext(JSContext*, JSDestroyContextMode) (jscntxt.cpp:1075)


The site of the failed allocation is:
at: VALGRIND_PRINTF_BACKTRACE (valgrind.h:4477)
by: js_malloc (jsutil.h:232)
by: js::GCHelperThread::replenishAndFreeLater(void*) (jsgc.cpp:2126)
by: js::GCHelperThread::freeLater(void*) (jsgc.h:928)
by: JSContext::free(void*) (jscntxt.h:2052)
by: JSString::finalize(JSContext*) (jsstrinlines.h:309)
by: void FinalizeArenaList<JSString>(JSCompartment*, JSContext*, unsigned int) (jsgc.cpp:1952)
by: JSCompartment::finalizeStringArenaLists(JSContext*) (jsgc.cpp:2029)
by: MarkAndSweep(JSContext*, JSGCInvocationKind) (jsgc.cpp:2468)
by: GCUntilDone(JSContext*, JSCompartment*, JSGCInvocationKind) (jsgc.cpp:2728)
by: js_GC(JSContext*, JSCompartment*, JSGCInvocationKind) (jsgc.cpp:2799)
by: js_DestroyContext(JSContext*, JSDestroyContextMode) (jscntxt.cpp:1075)
