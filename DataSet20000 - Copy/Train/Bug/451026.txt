Cookies not being sent with favicon.ico requests.
User-Agent:       Mozilla/5.0 (Macintosh; U; Intel Mac OS X 10_5_4; en-us) AppleWebKit/525.18 (KHTML, like Gecko) Version/3.1.2 Safari/525.20.1
Build Identifier: Mozilla/5.0 (Macintosh; U; Intel Mac OS X 10.5; en-US; rv:1.9.0.1) Gecko/2008070206 Firefox/3.0.1

Firefox does not replay cookies when requesting for "favicon.ico". favicon.ico requests are automatically generated by Firefox. However, if a site has set a cookie (typically session cookies such as ASP.Net, etc), these cookies aren't sent in the HTTP GET request when requesting "favicon.ico". Sometimes, this results in erroneous behaviour, when the site sends back a new "set-cookie" header in the reply for favicon.ico, overriding the previously set session cookie.

Reproducible: Always

Steps to Reproduce:
1. Start LiveHTTPHeaders
2. Load www.port80software.com (or any site that serves session cookies)
3. Look for the HTTP request for "favicon.ico". No cookies will have been sent in its GET request.
4. If the site returns back with a new Set-Cookie header, the old session cookie will be clobbered. This results in bad session handling at the server end.
Actual Results:  
Dump from LiveHTTPHeaders for www.port80software.com

http://www.port80software.com/

GET / HTTP/1.1
Host: www.port80software.com
User-Agent: Mozilla/5.0 (Macintosh; U; Intel Mac OS X 10.5; en-US; rv:1.9.0.1) Gecko/2008070206 Firefox/3.0.1
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
Accept-Language: en-us,en;q=0.5
Accept-Encoding: gzip,deflate
Accept-Charset: ISO-8859-1,utf-8;q=0.7,*;q=0.7
Keep-Alive: 300
Connection: keep-alive

HTTP/1.x 200 OK
Date: Mon, 18 Aug 2008 10:32:41 GMT
Server: Apache/2.2.0 (Unix) mod_ssl/2.2.0 OpenSSL/0.9.7g
Set-Cookie: countrycode=IN; path=/
Cache-Control: private
Content-Length: 7937
Content-Type: text/html
Content-Encoding: gzip
Vary: Accept-Encoding
----------------------------------------------------------
http://www.port80software.com/favicon.ico

GET /favicon.ico HTTP/1.1
Host: www.port80software.com
User-Agent: Mozilla/5.0 (Macintosh; U; Intel Mac OS X 10.5; en-US; rv:1.9.0.1) Gecko/2008070206 Firefox/3.0.1
Accept: image/png,image/*;q=0.8,*/*;q=0.5
Accept-Language: en-us,en;q=0.5
Accept-Encoding: gzip,deflate
Accept-Charset: ISO-8859-1,utf-8;q=0.7,*;q=0.7
Keep-Alive: 300
Connection: keep-alive

HTTP/1.x 200 OK
Date: Mon, 18 Aug 2008 10:32:48 GMT
Server: Apache/2.2.0 (Unix) mod_ssl/2.2.0 OpenSSL/0.9.7g
Last-Modified: Thu, 24 May 2007 17:33:30 GMT
Etag: "0d11daa4e3;299ec719de"
Accept-Ranges: bytes
Content-Length: 894
Content-Type: image/x-icon



Expected Results:  
What should have happened is cookies already set should be transmitted along with the favicon.ico request, as follows:

http://www.port80software.com/favicon.ico

GET /favicon.ico HTTP/1.1
Host: www.port80software.com
User-Agent: Mozilla/5.0 (Macintosh; U; Intel Mac OS X 10.5; en-US; rv:1.9.0.1) Gecko/2008070206 Firefox/3.0.1
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
Accept-Language: en-us,en;q=0.5
Accept-Encoding: gzip,deflate
Accept-Charset: ISO-8859-1,utf-8;q=0.7,*;q=0.7
Keep-Alive: 300
Connection: keep-alive
Cookie: countrycode=IN;
Pragma: no-cache
Cache-Control: no-cache


This happens on any site that sends across a session cookie. www.port80software.com was just an example. Firefox 2.0.0.16 (and I suspect other versions below) handles this situation CORRECTLY. FF 2.0.x properly transmits cookies, as expected.

I am flagging this bug as "major" because on some applications, it creates a session migration problem, especially if the session cookie gets overridden by a "Set-Cookie" header in the favicon response.