Don't write sessionstore.js to disk for "read only" event
User-Agent: Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.9.1.1) Gecko/20090715 Firefox/3.5.1
Build Identifier: Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.9.1.1) Gecko/20090715 Firefox/3.5.1

Although I appreciate that session restore really doe restore every detail of my session, this becomes unwieldy when sessionstore.js get large. With just 61 tab across 3 windows, my sessionstore.js is nearly 2MB. This result in over half a gigabyte of disk writes after an hour of browsing!

This 2MB file is rewritten in it entirety whenever:

1. I open or close a tab (obviously)
2. I click a link (since session restore remembers every tab's history)
3. I switch to another tab (since it remembers the currently open tab)
4. I scroll within a tab (since it remembers where I am in the page!)

Therefore, despite the 10-second hysteresis in rewriting this file, an active browsing session mean that it probably will get rewritten every 10 seconds. At 2MB a pop, that's 720MB per hour.

On my older machines, this is a very noticeable performace hit, especially when opening new tabs; on my laptops, this waste power; on my SSDs, it waste flash cycles.

Reproducible: Always

Steps to Reproduce:
1. Open many tab until sessionstore.js get quite large. (I am not sure why some page grow sessionstore.js by a few kilobyte and other page grow it by hundreds. As a rule of thumb, opening every article on the front page of CNN.com will get you close to 2MB.)

2. Open task manager (or equivalent) and watch the total disk writes generated by the Firefox process. Or use procmon (or equivalent) and watch Firefox rewrite sessionstore.js.

3. Observe rewrite occurring whenever a tab is opened, a link is clicked, a tab is selected, or a page is scrolled. Observe Firefox write multiple gigabyte after a mere evening's worth of ordinary browsing.
Actual Results:
For my usage patterns, I see Firefox writing 2-3GB per day, sometimes more. The vast majority of this is sessionstore activity, with sqllite contributing comparatively little.

Expected Results:
The session should be stored in a way that's amenable to partial updates. Throwing it into sqllite is probably overkill. Would it be difficult to write session activity a a log, and rewrite it only occasionally?

Some of the update are extremely small. Here are the diffs I get when I click on a new tab:

< {"state":"running","lastUpdate":1248521427588}})
--
> {"state":"running","lastUpdate":1248521292034}})

And here are the diffs I get when I scroll within an existing tab:

< {"state":"running","lastUpdate":1248521486237}})
--
> {"state":"running","lastUpdate":1248521427588}})

So in the worst-case scenario, where I'm not opening any tab but simply *reading for an hour*, I could conceivably generate 720MB of disk writes to update a little a 1800 byte of data (or 1.4MB, using 4k clusters). And all that just to remember where I've scrolled to in the page.

At the least, please add an option to tweak the behavior.

This is a fresh install of Firefox 3.5.1 on a fresh install of XP SP3 with the latest patches. The problem existed before I installed any extensions.
