new tab loading spins indefinitely  (some kind of dns-related  livelock?)
Sometime opening a link in a new tab the throbber spins indefinitely and loading new sites in new or existing tabs no longer works. Youtube video continues to play for a few tens of seconds, but then stops. This behaviour started in firefox 35 for fedora and persists in firefox 36.

At some point I pinned this down as a DNS problem - I think I first saw evidence of this on the browser console, but didn't save it. I did see evidence for this from tcpdump though:

Normal behaviour, loading the bbc news homepage:
$ tcpdump -vvv -n -i em1 -K dst port 53
tcpdump: listening on em1, link-type EN10MB (Ethernet), capture size 65535 bytes
... snipped lines...
32 packets captured
32 packets received by filter
0 packets dropped by kernel

After the problem starts, opening the bbc news homepage:
$ tcpdump -vvv -n -i em1 -K dst port 53
tcpdump: listening on em1, link-type EN10MB (Ethernet), capture size 65535 bytes
0 packets captured
0 packets received by filter
0 packets dropped by kernel

i.e. I see no dns lookups when opening new links, even to pages not visited in this session. I do see expected dns behaviour when running curl, so it's not some system-wide problem, just something that happens inside firefox.


Disconnecting/reconnecting NM doesn't make it start working again, nor does switch to IPV4-only in about:config, only quitting/restarting firefox does. Switching to IPV4-only may prevent the bug from triggering though, at least I've never had it happen with that configuration.


I do have this snippet in /etc/resolv.conf to workaround a broken DNS resolver on the local router - see https://bugzilla.redhat.com/show_bug.cgi?id=1182168 and links for context:

$ cat /etc/resolv.conf
# Generated by NetworkManager
domain home
search home
nameserver 192.168.1.254

# Automatically appended by /etc/NetworkManager/dispatcher.d/50-resolv-conf

# bt home hub dns resolver seems to break as described in resolv.conf(5)
#
# the other workaround is to set sysctl net.ipv6.conf.all.disable_ipv6=1
# and rely on all getaddrinfo() callers to set AI_ADDRCONFIG
# (see https://fedoraproject.org/wiki/Networking/NameResolution/ADDRCONFIG )
#

options single-request-reopen